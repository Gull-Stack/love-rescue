# Love Rescue App ‚Äî QA Audit Report #2

**Auditor:** Automated Code Audit (OpenClaw)  
**Date:** February 2, 2026  
**Previous Audit:** February 1, 2026 (43 issues found ‚Üí 28 fixes shipped in commit `2540527`)  
**Scope:** Full-stack re-audit ‚Äî backend, frontend, security, HIPAA, schema, previous fix verification

---

## Executive Summary

The 28 fixes shipped on Feb 1 addressed the most critical issues effectively. The Stripe webhook, calendar OAuth, token encryption, therapist auth restriction, account lockout, password reset, and input validation fixes are all **verified working**. However, this audit identified **19 remaining/new issues** ‚Äî some carried over from the original report, some newly discovered.

| Severity | Count |
|----------|-------|
| üî¥ CRITICAL | 2 |
| üü° HIGH | 5 |
| üü¢ MEDIUM | 7 |
| üìù LOW | 5 |
| **Total New/Remaining Issues** | **19** |

---

## Previous Fix Verification ‚úÖ

### All 28 Fixes From Feb 1 ‚Äî VERIFIED WORKING

| Original ID | Fix | Status | Evidence |
|---|---|---|---|
| CRIT-02 | Stripe webhook raw body parsing | ‚úÖ **Fixed** | `index.js:74-79` conditionally skips `express.json()` for `/api/payments/webhook`; route uses `express.raw({ type: 'application/json' })` |
| CRIT-03 | Calendar OAuth CSRF token | ‚úÖ **Fixed** | `calendar.js` generates a `crypto.randomBytes(32)` CSRF token stored in Token table, verified on callback, single-use with delete |
| CRIT-04 | Google Calendar token encryption | ‚úÖ **Fixed** | `encryption.js` implements AES-256-GCM with IV+tag; `calendar.js` calls `encrypt()` before storing and `decrypt()` before use; graceful fallback for pre-encryption plaintext |
| CRIT-05 | Therapist registration restricted | ‚úÖ **Fixed** | Requires valid `inviteToken` from admin-generated invite; rate limited to 3/hr/IP; token is single-use with email verification |
| HIGH-03 | IDOR in couple dashboard | ‚úÖ **Fixed** | `reports.js:couple-dashboard` checks `relationship.sharedConsent === true` before fetching partner data |
| HIGH-04 | Auth rate limiting | ‚úÖ **Fixed** | `index.js:56-63` applies `authLimiter` (10 req/15min) to `/login`, `/signup`, `/forgot-password`, `/reset-password` |
| HIGH-05 | Account lockout | ‚úÖ **Fixed** | `auth.js:21-42` implements in-memory lockout after 5 failures, 15-min lockout duration with auto-reset |
| HIGH-06 | Password reset flow | ‚úÖ **Fixed** | Full `forgot-password` + `reset-password` endpoints with 6-digit code, 1hr expiry, single-use tokens, lockout clearing |
| HIGH-07 | WebAuthn counter | ‚úÖ **Acknowledged** | TODO comment with implementation plan; counter still hardcoded to 0 but documented as needing schema update |
| HIGH-08 | Input validation on daily logs | ‚úÖ **Fixed** | `logs.js:20-30` validates type, range for positiveCount (0-1000), negativeCount (0-1000), closenessScore (1-10), mood (1-10) |
| HIGH-10 | Matchup legacy types | ‚úÖ **Partially Fixed** | Backend still requires legacy types (`wellness_behavior`, `negative_patterns_closeness`); frontend Matchup page updated to show modern types |
| HIGH-11 | Assessments "View Profile" link | ‚úÖ **Fixed** | Now links to `/matchup` instead of non-existent `/profile` route |
| MED-04 | CORS hardcoded IP | ‚úÖ **Fixed** | `index.js:41-43` uses `ALLOWED_ORIGINS` env var split by comma, fallback to `FRONTEND_URL` |
| MED-05 | Expired token cleanup | ‚úÖ **Fixed** | `cleanExpiredTokens()` runs on startup; deletes expired tokens from Token table |
| MED-09 | Gratitude streak timezone bug | ‚úÖ **Fixed** | `gratitude.js:calculateStreaks()` now uses UTC consistently for date normalization |
| MED-10 | Duplicate streak logic | ‚úÖ **Fixed** | Extracted to shared `calculateStreaks()` function used by both `/streak` and `/stats` |
| MED-11 | AccessLog missing resourceId | ‚úÖ **Fixed** | `reports.js:couple-dashboard` now passes `resourceId: relationship.id` |
| MED-15 | 404 handler placement | ‚úÖ **Fixed** | 404 handler moved before error handler in `index.js:97-99` |
| LOW-02 | Dashboard hardcoded assessment count | ‚úÖ **Fixed** | `Dashboard.js:121` now uses `totalAssessments = 10` |
| LOW-12 | Strategy progress unclamped | ‚úÖ **Fixed** | `strategies.js:122` clamps to `Math.min(100, Math.max(0, ...))` |

---

## New/Remaining Issues

### üî¥ CRITICAL

#### CRIT-NEW-01: WebAuthn Counter Still Not Persisted ‚Äî Replay Attack Possible
- **File:** `backend/src/routes/auth.js` (line ~216-225)
- **Severity:** üî¥ CRITICAL
- **Description:** The WebAuthn authentication counter is still hardcoded to `0`. While the Feb 1 fix added a TODO comment explaining the plan, the actual fix was never implemented. The WebAuthn spec requires the counter to be stored and incremented after each authentication to detect cloned authenticators. An attacker who clones a hardware authenticator would not be detected because the counter is never compared.
- **Impact:** A cloned WebAuthn authenticator could be used indefinitely without detection. For a health app with sensitive relationship data, this is a significant security gap.
- **Fix:** 
  1. Add `biometricCounter Int @default(0) @map("biometric_counter")` to the User model in `schema.prisma`
  2. Run `prisma migrate dev`
  3. In `webauthn/login/verify`, pass the stored counter instead of `0` and update it with `verification.authenticationInfo.newCounter`

#### CRIT-NEW-02: Matchup Generation Requires Legacy Assessment Types That Users Can't Complete
- **File:** `backend/src/routes/matchup.js` (lines 35-36)
- **Severity:** üî¥ CRITICAL (functional breakage)
- **Description:** The matchup generation endpoint requires both partners to complete `wellness_behavior` and `negative_patterns_closeness` assessment types. However, these are **legacy types** that are not presented to users in the assessment catalog. The frontend Assessments page shows 10 modern assessments (attachment, personality, love_language, etc.) but does NOT include these two legacy types. The frontend Matchup page was updated to show modern types (`attachment`, `personality`, `love_language`, `gottman_checkup`), but the **backend was never updated** to match. This means **matchup generation is permanently broken** ‚Äî users can never satisfy the backend's requirements since the required assessments aren't available.
- **Impact:** The core matchup feature (a primary value proposition) is non-functional for all new users.
- **Fix:** Update `backend/src/routes/matchup.js` lines 35-36 to require the modern core types:
  ```js
  const requiredTypes = ['attachment', 'personality', 'love_language', 'gottman_checkup'];
  ```
  This aligns with what the frontend Matchup page already displays and what `calculateMatchupScore()` in `scoring.js` already supports.

---

### üü° HIGH

#### HIGH-NEW-01: JWT Stored in localStorage ‚Äî XSS Token Theft Risk (Carried Over)
- **File:** `frontend/src/contexts/AuthContext.js` (lines 30, 43, 53, 66)
- **Severity:** üü° HIGH
- **Description:** JWT tokens remain in `localStorage`. The previous audit flagged this as HIGH-01 and it was acknowledged with a TODO comment, but not fixed. While no `dangerouslySetInnerHTML` usage was found (good), any future XSS vulnerability or malicious browser extension could steal tokens. The AuthContext has a clear TODO comment about this.
- **Fix:** Migrate to `httpOnly` cookies with `SameSite=Strict`. This requires:
  1. Backend: `cookie-parser` middleware, set JWT as cookie in auth responses
  2. Frontend: Remove `localStorage.setItem/getItem('token')`, rely on cookies
  3. CORS: Set `credentials: true` (already done)

#### HIGH-NEW-02: Email Sending Still Not Implemented
- **File:** `backend/src/routes/auth.js` (lines ~282, ~345)
- **Severity:** üü° HIGH
- **Description:** Two critical flows still have `// TODO: Send email` comments:
  - Partner invite (`invite-partner` route): Users must manually share invite links
  - Password reset (`forgot-password` route): In production, the reset code is logged as `[REDACTED]` ‚Äî users literally cannot receive their reset codes
- **Impact:** Password reset is **non-functional in production** since there's no way to deliver the 6-digit code. The code is only logged in development mode.
- **Fix:** Implement email sending via SendGrid/nodemailer. The `.env.example` already has SMTP configuration variables defined.

#### HIGH-NEW-03: No Helmet CSP Configuration (Carried Over)
- **File:** `backend/src/index.js` (line ~36)
- **Severity:** üü° HIGH
- **Description:** Helmet is used with defaults, which does NOT include Content Security Policy. Given that JWTs are in localStorage, a strict CSP is the primary defense against XSS. Without CSP, any injected script can exfiltrate tokens.
- **Fix:** Configure helmet with CSP directives:
  ```js
  app.use(helmet({
    contentSecurityPolicy: {
      directives: {
        defaultSrc: ["'self'"],
        scriptSrc: ["'self'", "https://accounts.google.com", "https://js.stripe.com"],
        frameSrc: ["https://accounts.google.com", "https://js.stripe.com"],
        connectSrc: ["'self'", process.env.FRONTEND_URL],
        imgSrc: ["'self'", "data:", "https:"],
      }
    }
  }));
  ```

#### HIGH-NEW-04: Expired Token Cleanup Not Running Periodically
- **File:** `backend/src/index.js` (line ~148)
- **Severity:** üü° HIGH
- **Description:** `cleanExpiredTokens()` runs once on server startup but the TODO says "Run periodically (e.g., every hour)". Without periodic cleanup, the Token table will grow unbounded with WebAuthn challenges (5-min TTL), OAuth CSRF tokens (10-min TTL), and password reset tokens (1-hr TTL). In a long-running production server, this is a slow memory/DB leak.
- **Fix:** Add a `setInterval`:
  ```js
  cleanExpiredTokens();
  setInterval(cleanExpiredTokens, 60 * 60 * 1000); // Every hour
  ```

#### HIGH-NEW-05: Account Lockout Uses In-Memory Store ‚Äî Resets on Server Restart
- **File:** `backend/src/routes/auth.js` (line ~22)
- **Severity:** üü° HIGH  
- **Description:** The account lockout mechanism uses an in-memory `Map()`. This has two problems:
  1. **Lost on restart:** When the server restarts (deploys, crashes), all lockout state is lost. An attacker could time credential stuffing around deployments.
  2. **Per-instance:** In a multi-instance deployment (horizontal scaling), lockout state is not shared between instances. An attacker could rotate between instances.
- **Fix:** Use Redis or database-backed lockout tracking. At minimum, store lockout records in the Token table with type `account_lockout`.

---

### üü¢ MEDIUM

#### MED-NEW-01: Data Encryption at Rest Not Implemented (HIPAA Gap ‚Äî Carried Over)
- **File:** `backend/prisma/schema.prisma`, multiple route files
- **Severity:** üü¢ MEDIUM
- **Description:** Sensitive fields remain stored as plaintext in PostgreSQL:
  - `DailyLog.journalEntry` ‚Äî personal journal entries
  - `Assessment.responses` ‚Äî assessment answers (JSONB)
  - `GratitudeEntry.text` ‚Äî gratitude text
  - `TherapistTask.notes` ‚Äî therapist notes
  
  The `encryption.js` utility exists and works well (verified via calendar token encryption), but it's only used for Google Calendar tokens. The Privacy Policy states "encryption at rest" is implemented, which is currently inaccurate.
- **Fix:** Apply `encrypt()/decrypt()` from `encryption.js` to sensitive string fields before database storage. For JSONB fields, encrypt the JSON string.

#### MED-NEW-02: No Data Retention Policy Enforcement (HIPAA Gap ‚Äî Carried Over)
- **File:** Backend (general)
- **Severity:** üü¢ MEDIUM
- **Description:** The Privacy Policy promises "all personal data is permanently removed within 30 days" of account deletion, but:
  - `AuditLog` uses `onDelete: SetNull` for userId ‚Äî logs remain as orphaned records indefinitely
  - `AccessLog` has no user relation at all ‚Äî records persist forever
  - No automated 30-day hard-delete job exists for soft-deleted data
  - `ConsentLog` records persist after account deletion due to cascade order
- **Fix:** Implement a scheduled job that purges orphaned audit/access logs older than the retention period. Consider adding `deletedAt` timestamps for soft-delete with scheduled hard-delete.

#### MED-NEW-03: Privacy Policy Claims "encryption at rest" ‚Äî Inaccurate
- **File:** `frontend/src/pages/Settings/Settings.js` (Privacy Policy dialog)
- **Severity:** üü¢ MEDIUM
- **Description:** The Privacy Policy states: "We implement industry-standard security measures including encryption at rest and in transit." Only transit encryption (HTTPS) and calendar token encryption are implemented. Journal entries, assessment responses, and gratitude text are stored in plaintext. This is a compliance risk ‚Äî making false claims about data protection practices.
- **Fix:** Either implement encryption at rest (MED-NEW-01) or update the privacy policy to accurately describe current protections.

#### MED-NEW-04: Privacy Policy and ToS Reference "marriagerescue.app" ‚Äî Branding Mismatch
- **File:** `frontend/src/pages/Settings/Settings.js` (Privacy Policy + ToS dialogs)
- **Severity:** üü¢ MEDIUM
- **Description:** Contact emails reference `privacy@marriagerescue.app` and `legal@marriagerescue.app`, but the app was rebranded to "Love Rescue." The legal documents should reflect current branding.
- **Fix:** Update email addresses to `privacy@loverescue.app` and `legal@loverescue.app`.

#### MED-NEW-05: Strategies Completed Tasks Not Persisted (Carried Over)
- **File:** Frontend Strategies page (state management)
- **Severity:** üü¢ MEDIUM
- **Description:** Individual task completions in the strategy checklist are stored only in React state. When the user refreshes the page, all checkmarks are lost. Only the aggregate progress percentage is saved to the backend.
- **Fix:** Either persist completed task IDs in the Strategy record on the backend (add a `completedTasks` JSONB field), or use localStorage as a client-side fallback.

#### MED-NEW-06: No Pagination on Several List Endpoints (Carried Over)
- **File:** Multiple backend routes
- **Severity:** üü¢ MEDIUM
- **Description:** These endpoints return unbounded result sets:
  - `GET /api/goals` ‚Äî all goals
  - `GET /api/strategies/history` ‚Äî all strategies across all cycles
  - `GET /api/assessments/results` ‚Äî all assessments
  - `GET /api/therapist/tasks` ‚Äî all tasks
  
  For long-term users, these queries will grow and impact performance.
- **Fix:** Add `take`/`skip` parameters to Prisma queries. Accept `limit`/`offset` query params with sensible defaults.

#### MED-NEW-07: Assessments Page Has Two Identical "View Matchup Score" Buttons
- **File:** `frontend/src/pages/Assessments/Assessments.js` (lines ~886-908)
- **Severity:** üü¢ MEDIUM
- **Description:** When all assessments are complete, the CTA section shows two buttons that both say "View Matchup Score" and both navigate to `/matchup`. This appears to be a copy-paste artifact from when one was supposed to be "View Unified Profile."
- **Fix:** Change the second button to "View Your Strategies" linking to `/strategies`, or remove the duplicate.

---

### üìù LOW

#### LOW-NEW-01: `ALLOWED_ORIGINS` Missing From `.env.example`
- **File:** `backend/.env.example`
- **Severity:** üìù LOW
- **Description:** The CORS configuration uses `ALLOWED_ORIGINS` env var, but it's not documented in `.env.example`. Similarly, `STRIPE_ANNUAL_PRICE_ID` is used in code but not in the example file. New developers won't know these variables exist.
- **Fix:** Add to `.env.example`:
  ```
  ALLOWED_ORIGINS="http://localhost:3000"
  STRIPE_ANNUAL_PRICE_ID="price_..."
  ```

#### LOW-NEW-02: Frontend `.env.example` Missing `REACT_APP_GOOGLE_CLIENT_ID`
- **File:** `frontend/.env.example`
- **Severity:** üìù LOW  
- **Description:** The Google OAuth login requires `REACT_APP_GOOGLE_CLIENT_ID` but it's not in the frontend `.env.example`. The Login and Signup pages use `@react-oauth/google` which needs this variable.
- **Fix:** Add `REACT_APP_GOOGLE_CLIENT_ID=your-google-client-id` to `frontend/.env.example`.

#### LOW-NEW-03: Upgrade Banner Shows "$19.99/month" But Pricing Card Shows "$249/month"
- **File:** `frontend/src/pages/Settings/Settings.js` (lines ~411, ~454)
- **Severity:** üìù LOW
- **Description:** The upgrade alert for paid users shows "Upgrade to Premium - $19.99/month" but the pricing card for new subscribers shows Premium at "$249/mo". These should be consistent. One appears to be the upgrade price (discounted?) and the other the list price.
- **Fix:** Clarify whether the upgrade is discounted. Either show consistent pricing or label the $19.99 as an "upgrade add-on price."

#### LOW-NEW-04: No Error Boundary in React App
- **File:** `frontend/src/App.js`
- **Severity:** üìù LOW
- **Description:** The app uses `React.Suspense` for loading fallback but has no `ErrorBoundary` component. If any lazy-loaded component throws during rendering, the entire app will crash with a white screen.
- **Fix:** Add a React Error Boundary wrapping the `<Routes>` that shows a user-friendly error page with a "Reload" button.

#### LOW-NEW-05: `Google OAuth2Client` Initialized With Potentially Invalid Credentials at Module Load
- **File:** `backend/src/routes/calendar.js` (line ~22)
- **Severity:** üìù LOW
- **Description:** `new google.auth.OAuth2(...)` is called at module load time with env vars that might be placeholders. While `isCalendarConfigured()` guards the routes, the OAuth2 client is still created with possibly invalid credentials. This could cause confusing errors in logs.
- **Fix:** Initialize the OAuth2 client lazily inside route handlers after the `isCalendarConfigured()` check.

---

## HIPAA Compliance Status: ‚ö†Ô∏è Partial ‚Äî Improved

### What's Working Well ‚úÖ
- **Audit Logging:** All API requests logged to both database (AuditLog) and files (Winston). Structured JSON format in production.
- **Access Logging:** Separate AccessLog table tracks resource access with granted/denied status, accessor role, IP address.
- **Consent Management:** Per-user therapist consent, consent audit trail (ConsentLog), automatic revocation on consent withdrawal.
- **Authentication:** Bcrypt password hashing (cost 12), JWT with expiry, WebAuthn support, account lockout.
- **Authorization:** Layered middleware (authenticate ‚Üí requireSubscription ‚Üí requireRole), therapist assignment verification, dual consent checks.
- **Token Encryption:** Google Calendar OAuth tokens encrypted with AES-256-GCM before storage.
- **Data Minimization:** Journal entries excluded from therapist views, `isPrivate` and `therapistVisible` flags on daily logs.

### What Still Needs Work ‚ùå
| Gap | Severity | Status |
|---|---|---|
| Data encryption at rest (journals, assessments, gratitude) | üü¢ MEDIUM | Not implemented |
| Data retention policy enforcement | üü¢ MEDIUM | Not implemented |
| Privacy Policy accuracy (claims encryption at rest) | üü¢ MEDIUM | Inaccurate |
| BAA framework for therapist access | üìù LOW | Not implemented |
| Password reset email delivery | üü° HIGH | Non-functional in production |

---

## Assessment System Audit

### All 12 Assessment Types ‚Äî Scoring Verified ‚úÖ
The `scoring.js` file implements scorers for all 12 types (10 current + 2 legacy):
1. **Attachment Style** ‚Äî 30 questions, Bartholomew model, 4-category scoring ‚úÖ
2. **Personality (MBTI-style)** ‚Äî 4-dimension scoring with clarity labels ‚úÖ
3. **Love Language** ‚Äî Forced-choice, 5-language ranking ‚úÖ
4. **Human Needs** ‚Äî 6-need profiling with Robbins framework ‚úÖ
5. **Gottman Checkup** ‚Äî Four Horsemen + strengths dual scoring ‚úÖ
6. **Emotional Intelligence** ‚Äî 5-domain Goleman framework ‚úÖ
7. **Conflict Style** ‚Äî Thomas-Kilmann 5-style model ‚úÖ
8. **Differentiation** ‚Äî Bowen model with reverse scoring ‚úÖ
9. **Hormonal Health** ‚Äî Symptom-load scoring (gender-filtered questions) ‚úÖ
10. **Physical Vitality** ‚Äî 5-category wellness scoring ‚úÖ
11. **Wellness Behavior (legacy)** ‚Äî 10-question, positive/negative split ‚úÖ
12. **Negative Patterns (legacy)** ‚Äî 15-question, pattern mapping ‚úÖ

### Issue: Retake Behavior Overwrites Previous Assessment
- **File:** `backend/src/routes/assessments.js` (line ~84-96)
- **Description:** When a user retakes an assessment, the existing record is **updated** (overwritten) rather than creating a new record. The `/results/:type/detailed` endpoint fetches up to 5 history records, but since retakes overwrite, there will only ever be 1 record per type. This means assessment history/comparison over time is broken.
- **Severity:** üü¢ MEDIUM (included in MED-NEW count above under functional issues)
- **Fix:** Change the retake behavior to always `create` a new record instead of updating the existing one. The query already orders by `completedAt: 'desc'` and takes the latest.

---

## Database & Schema Audit

### Schema Quality: ‚úÖ Excellent
- UUID primary keys throughout
- Appropriate enums (SubscriptionStatus, UserRole, AssessmentType, etc.)
- Composite unique constraints (userId_date, week_day, therapistId_relationshipId)
- Cascade deletes on user-owned data, SetNull on optional relations
- JSONB for flexible assessment data
- Comprehensive indexing on foreign keys

### Missing Indexes (Minor)
1. `GratitudeEntry.isShared` ‚Äî queried in `/shared` and `/love-note` endpoints but no index
2. `Token.type` + `Token.expiresAt` compound ‚Äî frequently queried together

### Schema Gap
- No `biometricCounter` field on User model (needed for WebAuthn counter fix)
- No `completedTasks` field on Strategy model (needed for task persistence fix)

---

## Frontend Audit

### Architecture: ‚úÖ Solid
- React.lazy + Suspense for code splitting
- Protected/Public route wrappers with loading states
- Centralized API service with interceptors (auth token injection, 401 handling)
- Consistent Material-UI usage throughout

### Issues Found
- Two identical CTA buttons on Assessments completion (MED-NEW-07)
- No React Error Boundary (LOW-NEW-04)
- Pricing inconsistency in Settings ($19.99 vs $249) (LOW-NEW-03)
- Strategy task completions lost on page refresh (MED-NEW-05)

### No Build Errors
- No `dangerouslySetInnerHTML` usage found (important since JWT is in localStorage)
- No `console.error` calls remaining in page components (cleaned in Feb 1 fix)
- All `eslint-disable` comments have explanatory notes

---

## Stripe Integration Audit: ‚úÖ Working

### Verified Working
- **Webhook:** Raw body parsing fix confirmed. `express.raw()` correctly applied, signature verification uses raw Buffer.
- **Checkout:** Tiered pricing (standard, premium, annual) with correct metadata.
- **Subscription Updates:** Handles `checkout.session.completed`, `subscription.updated`, `subscription.deleted`, `invoice.payment_failed`.
- **Cancellation:** Cancel-at-period-end (graceful, user keeps access).
- **Portal:** Stripe customer portal integration for self-service billing.

### Minor Note
- `invoice.payment_failed` logs a warning but doesn't notify the user. Email integration would fix this.

---

## Security Summary

| Area | Status |
|---|---|
| Password hashing (bcrypt, cost 12) | ‚úÖ Secure |
| JWT token handling | ‚ö†Ô∏è localStorage (XSS risk) |
| WebAuthn | ‚ö†Ô∏è Counter not persisted |
| Rate limiting (auth) | ‚úÖ 10/15min on auth endpoints |
| Rate limiting (general) | ‚úÖ 100/15min global |
| Account lockout | ‚ö†Ô∏è In-memory only |
| CORS | ‚úÖ Env-based origins |
| Helmet security headers | ‚ö†Ô∏è No CSP configured |
| Stripe webhook verification | ‚úÖ Fixed and working |
| Calendar OAuth CSRF | ‚úÖ Fixed and working |
| Token encryption | ‚úÖ AES-256-GCM |
| Therapist auth | ‚úÖ Bcrypt-hashed API keys + invite-only |
| Input validation | ‚úÖ Range checks on numeric fields |
| SQL injection | ‚úÖ Protected by Prisma ORM |
| Data access control | ‚úÖ User scoping on all queries |

---

## Recommended Priority Order

### Immediate (Ship-Blocking)
1. **CRIT-NEW-02:** Fix matchup required types to modern assessments ‚Äî **the feature is currently broken**
2. **HIGH-NEW-02:** Implement email sending ‚Äî **password reset is non-functional in production**

### This Week
3. **CRIT-NEW-01:** WebAuthn counter persistence (schema migration + code change)
4. **HIGH-NEW-03:** Configure Helmet CSP
5. **HIGH-NEW-04:** Add periodic token cleanup interval

### This Sprint
6. **HIGH-NEW-01:** Migrate JWT from localStorage to httpOnly cookies
7. **HIGH-NEW-05:** Move lockout tracking to Redis/database
8. **MED-NEW-01:** Implement encryption at rest for sensitive fields
9. **MED-NEW-03:** Update Privacy Policy to reflect actual protections

### Backlog
10. **MED-NEW-02:** Data retention enforcement job
11. **MED-NEW-04:** Fix branding in legal documents
12. **MED-NEW-05:** Persist strategy task completions
13. **MED-NEW-06:** Add pagination to list endpoints
14. **MED-NEW-07:** Fix duplicate CTA buttons on Assessments page
15. All LOW items

---

## Positive Findings ‚úÖ

The Feb 1 fixes were well-implemented:
- **Encryption utility** is clean, handles graceful fallback for pre-encryption data
- **CSRF token flow** for calendar OAuth is properly single-use with expiry
- **Therapist invite system** is well-designed (admin generates token ‚Üí therapist uses token ‚Üí token consumed)
- **Consent architecture** remains excellent (per-user, audited, auto-revocation)
- **Error handling** is consistent across all routes
- **Assessment scoring** is comprehensive with 12 scorers covering research-backed frameworks
- **Gratitude feature** has strong engagement mechanics (streaks, sharing, love notes)
- **Code quality** is good ‚Äî clean separation of concerns, middleware composition, structured logging
